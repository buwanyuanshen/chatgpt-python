<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT-3.5</title>
    <style>
h1 {
            text-align: center;
            font-size: 35px;
            color:#1E90FF ;
        }

        .container {
            width: 80%;
            margin: 0 auto;
            padding-#1E90FFtop: 1px;
        }

        .conversation-label,
        .response-label {
            color: #00AADD;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 2px;
        }

       .input-box {
    width: 100%;
    height: 43px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    background-color: rgba(173, 216, 230, 0.3); /* ä½¿ç”¨rgbaæ¥å®šä¹‰é€æ˜çš„èƒŒæ™¯é¢œè‰² */
    border: 2px solid lightblue;
    border-radius: 5px;
    padding: 3px;
    resize: none;
    outline: none;
    font-weight: bold;
    color:  black;
}

.response-box {
    width: 100%;
    height: 150px;
    font-family: Arial, sans-serif;
    font-size: 15px;
    background-color: rgba(173, 216, 230, 0.3); /* ä½¿ç”¨rgbaæ¥å®šä¹‰é€æ˜çš„èƒŒæ™¯é¢œè‰² */
    border: 2px solid lightblue;
    border-radius: 5px;
    padding: 3px;
    resize: none;
    overflow-y: auto;
    margin-bottom: 1px;
    outline: none;
    font-weight: bold;
}
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 2px;
        }

        .button {
            width: 90px;
            display: inline-block;
            background-color: lightblue;
            color: #0099FF;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            border: none;
            border-radius: 3px;
	    font-weight: bold;
            cursor: pointer;
            margin: 0 35px;
        }

        .button:hover {
            background-color: blue;
        }

        .clear-button {
            background-color: lightblue;
        }

        .clear-button:hover {
            background-color: red;
        }

        .author-info {
            position: fixed;
            top: 5px;
            right: 5px;
            color: gold;
            font-size: 5px;
            background-image: linear-gradient(45deg, #00bcd4, #ff4081);
            padding: 10px 20px;
            border-radius: 40px;
            text-transform: uppercase;
            font-family: "Arial", sans-serif;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px #00bcd4, 0 0 20px #00bcd4, 0 0 30px #00bcd4;
            }
            to {
                box-shadow: 0 0 20px #00bcd4, 0 0 40px #00bcd4, 0 0 60px #00bcd4;
            }
        }

        .author-info a {
            color: #fff;
            text-decoration: none;
        }
.checkbox-container {
  display: flex;
  align-items: center;
}

.checkbox-container input[type="checkbox"] {
  margin-right: 8px;
  appearance: none;
  -webkit-appearance: none;
  width: 22px;
  height: 22px;
  border: 2px solid blue;
  border-radius: 4px;
  outline: none;
  cursor: pointer;
}

.checkbox-container input[type="checkbox"]:checked {
  background-color: #2196F3;
  border-color: #2196F3;
}

.checkbox-container input[type="checkbox"]:checked::before {
  content: "";
  position: absolute;
  top: 4px;
  left: 8px;
  width: 8px;
  height: 12px;
  border-right: 2px solid blue;
  border-bottom: 2px solid blue;
  transform: rotate(45deg);
}

.checkbox-container label {
  font-size: 16px;
}

/* ç”¨æˆ·æ¶ˆæ¯æ ·å¼ */
.user-message {
    color: black; 
}

/* GPTå›å¤æ ·å¼ */
.gpt-response {
    color: red; 
}
.input-box::placeholder {
    color: black; 
}
    </style>
</head>
<body>
<div class="container">
<h1>GPT-3.5</h1>
<div>
<label class="conversation-label">ç³»ç»Ÿè§’è‰²ï¼š</label><br>
<input type="text" id="system-message" class="input-box" placeholder="è¾“å…¥gptçš„é¢„è®¾è§’è‰²">
</div>
<div>
<label class="conversation-label">ç”¨æˆ·è¾“å…¥æ¡†ï¼š</label><br>
<textarea id="user-input" class="input-box" placeholder="2023.9.26å·²æ›´æµå¼å¿«é€Ÿå“åº”ï¼Œå¿«æ¥ä½“éªŒå§ï¼ï¼ï¼ğŸ•ğŸ•ğŸ•"></textarea>
</div>
<div>
<label class="conversation-label">é€‰æ‹©GPTæ¨¡å‹ï¼ˆ5ç§ï¼‰ï¼š</label><br>
<select id="model-select" class="input-box">
{% for key, value in models.items() %}
<option value="{{ key }}">{{ value }}</option>
{% endfor %}
</select>
</div>
<div>
<label class="conversation-label">æ¸©åº¦ï¼ˆTemperatureï¼‰ï¼š</label><br>
<input type="float" id="temperature" class="input-box" placeholder="èŒƒå›´>=0ï¼Œæ¥è¿‘0å€¾å‘è¿è´¯æ€§ï¼Œè¶Šå¤§å€¾å‘å¤šæ ·æ€§ï¼Œå»ºè®®0-1">
</div>
<div>
<label class="conversation-label">æœ€å¤§ä»¤ç‰Œæ•°ï¼ˆMax-Tokensï¼‰ï¼š</label><br>
<input type="int" id="max-tokens" class="input-box" placeholder="æœ€å¤§èŒƒå›´4000/16000ï¼Œé»˜è®¤æ¨¡å‹æœ€å¤§ä¸è¶…è¿‡4000ï¼Œä»£è¡¨å¯¹è¯æ€»å­—æ•°">
</div>
<div>
  <div class="checkbox-container">
    <label for="continuous-chat" class="conversation-label">å¼€å¯è¿ç»­å¯¹è¯ï¼š</label>
    <input type="checkbox" id="continuous-chat">
  </div>
</div>
<div>
<label class="response-label">å¯¹è¯æ¶ˆæ¯è®°å½•æ¡†ï¼š</label><br>
<!-- ä¿®æ”¹é€ä¸ªå­—æ˜¾ç¤ºçš„æ–‡æœ¬æ¡† -->
<div id="response-text" class="response-box"></div>
</div>
<br>
<div class="button-container">
<button id="send-button" class="button">å‘é€</button>
<button id="clear-button" class="button clear-button">æ¸…ç©º</button>
</div>
<div class="author-info">BY-ä¸­åŒ—é”‹å“¥-2023.09.26</div>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    // è®¾ç½®é»˜è®¤å€¼
    document.getElementById("system-message").value = "You are a helpful assistant.";
    document.getElementById("temperature").value = "0.2";
    document.getElementById("max-tokens").value = "12345";
  });

  document.getElementById("send-button").addEventListener("click", function () {
    // è·å–ç”¨æˆ·è¾“å…¥å’Œé€‰å®šçš„æ¨¡å‹
    var user_input = document.getElementById("user-input").value;
    var selected_model = document.getElementById("model-select").value;
    var system_message = document.getElementById("system-message").value;
    var temperature = parseFloat(document.getElementById("temperature").value);
    var max_tokens = parseInt(document.getElementById("max-tokens").value);
    var continuous_chat = document.getElementById("continuous-chat").checked; // è·å–è¿ç»­å¯¹è¯å¤é€‰æ¡†çŠ¶æ€

    // æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦ä¸ºç©º
    if (user_input === "") {
      alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ¶ˆæ¯å†…å®¹ã€‚");
      return; // ä¸å‘é€è¯·æ±‚
    }

    // å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
    fetch("/get_response", {
      method: "POST",
      body: JSON.stringify({
        user_input: user_input,
        selected_model: selected_model,
        system_message: system_message,
        temperature: temperature,
        max_tokens: max_tokens,
        continuous_chat: continuous_chat
      }),
      headers: {
        "Content-Type": "application/json" // æ›´æ–° Content-Type
      }
    })
    .then(response => response.body.getReader()) // è·å–å¯è¯»æµ
    .then(reader => {
      // è·å–è¦é€ä¸ªå­—æ˜¾ç¤ºçš„æ–‡æœ¬æ¡†
      var responseTextElement = document.getElementById("response-text");

      // åˆ›å»ºä¸€ä¸ªåŒ…å«ç”¨æˆ·æ¶ˆæ¯çš„æ–°å¯¹è¯æ¡ç›®
      var userMessage = document.createElement("div");
      userMessage.className = "user-message";
      userMessage.textContent = "ç”¨æˆ·ï¼š" + user_input;
      responseTextElement.appendChild(userMessage);

      // åˆ›å»ºä¸€ä¸ªåŒ…å«GPTå›å¤çš„æ–°å¯¹è¯æ¡ç›®
      var gptResponse = document.createElement("div");
      gptResponse.className = "gpt-response";
      gptResponse.textContent = "GPT3.5: ";
      responseTextElement.appendChild(gptResponse);

      // é€ä¸ªå­—é€ä¸ªå­—åœ°å°†GPTå›å¤æ·»åŠ åˆ°å¯¹è¯æ¡†ä¸­
      const decoder = new TextDecoder();
      reader.read().then(function processText({ done, value }) {
        if (done) {
          return;
        }
        gptResponse.textContent += decoder.decode(value);
        responseTextElement.scrollTop = responseTextElement.scrollHeight; // æ»šåŠ¨åˆ°åº•éƒ¨
        reader.read().then(processText);
      });

      // æ¸…ç©ºç”¨æˆ·è¾“å…¥æ¡†
      document.getElementById("user-input").value = "";
    })
    .catch(error => {
      console.error(error);
      // å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå¼¹å‡ºé”™è¯¯æç¤ºæ¡†
      alert("å‘ç”Ÿé”™è¯¯ï¼š" + error.message);
    });
  });
//æ¸…é™¤tokens
 document.addEventListener("DOMContentLoaded", function () {
  const clearButton = document.getElementById("clear-button");

  clearButton.addEventListener("click", function () {
    // å‘æœåŠ¡å™¨å‘é€æ¸…é™¤è¯·æ±‚
    fetch("/clear_history", {
      method: "POST",
    })
      .then((response) => response.json())
      .then((data) => {
// æ¸…ç©ºç”¨æˆ·è¾“å…¥å’Œé€ä¸ªå­—æ˜¾ç¤ºçš„æ–‡æœ¬æ¡†
            document.getElementById("user-input").value = "";
            document.getElementById("response-text").innerHTML = "";
      })
      .catch((error) => {
        console.error("æ¸…é™¤è¯·æ±‚å¤±è´¥: ", error);
      });
  });
});

 // è·å–æŒ‰é’®å…ƒç´ 
        var sendButton = document.getElementById("send-button");
        var clearButton = document.getElementById("clear-button");

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        sendButton.addEventListener("click", function() {
            // åœ¨æŒ‰é’®ç‚¹å‡»æ—¶æ·»åŠ è§†è§‰åé¦ˆæ ·å¼
            sendButton.classList.add("button-clicked");

            // å‘é€è¯·æ±‚å¹¶è·å–å“åº”
            getResponse();
        });

        clearButton.addEventListener("click", function() {
            // åœ¨æŒ‰é’®ç‚¹å‡»æ—¶æ·»åŠ è§†è§‰åé¦ˆæ ·å¼
            clearButton.classList.add("button-clicked");

        });

</script>
</body>
</html>
